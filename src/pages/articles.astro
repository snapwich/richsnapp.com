---
import { getCollection } from "astro:content";
import BasicPage from "layouts/BasicPage.astro";
import { parseSlugDate } from "utils/date";
import Tags from "components/Tags.astro";
import PostPreviewList from "components/PostPreviewList.astro";

const blogPosts = await getCollection("blog");
const articlePosts = await getCollection("article");

const combinedPosts = [...blogPosts, ...articlePosts].sort(
  (a, b) =>
    parseSlugDate(b.slug).date.valueOf() - parseSlugDate(a.slug).date.valueOf(),
);

const tagSet = combinedPosts.reduce((memo, post) => {
  for (let tag of post.data.tags) {
    memo.add(tag);
  }
  return memo;
}, new Set<string>());
const allTags = Array.from(tagSet).sort();
---

<BasicPage>
  <Tags tags={allTags} className="top-tags" />
  <PostPreviewList posts={articlePosts} />
</BasicPage>

<style lang="less">
  @import "../styles/variables.less";

  .top-tags {
    font-size: 20px;
    margin: 0 4em 2em;
    text-align: center;
    @media (max-width: @screen-sm-max) {
      margin-left: 0;
      margin-right: 0;
    }
  }
</style>
