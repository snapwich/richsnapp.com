---
interface Props {
  identifier: string;
}

const { identifier } = Astro.props;

declare global {
  interface Window {
    disqus_config: (this: {
      page: { url: string; identifier: string };
    }) => void;
  }
}
---

<div id="disqus_thread" data-identifier={identifier}></div>
<script>
  import { getCanonicalUrl } from "utils/links";

  window.disqus_config = function () {
    let data = document.getElementById("disqus_thread")!.dataset;
    let canonicalUrl = getCanonicalUrl();
    if (canonicalUrl) {
      this.page.url = canonicalUrl;
    } else {
      console.error("disqus canonical URL not found");
    }
    if (data.identifier) {
      this.page.identifier = data.identifier;
    } else {
      console.error("#disqus_thread[data-identifier] not found");
    }
  };
  (function () {
    var d = document,
      s = d.createElement("script");
    s.src = "https://richsnapp.disqus.com/embed.js";
    s.setAttribute("data-timestamp", String(+new Date()));
    (d.head || d.body).appendChild(s);
  })();
</script>
